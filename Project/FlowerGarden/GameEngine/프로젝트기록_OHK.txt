[오해강 D2D프로젝트 기록]

[사운드 매니저를 만들자]

오후 7:27 2023-07-25
 fmod를 붙이자
----------------------------------
오전 2:03 2023-07-26
간단한 FMOD정리 끝
멤버함수와 이니셜라이즈를 정리했다.
이제 FMOD가 가진 기능들을 알아보고
내가 원하는 구현들을 구현해야한다.
----------------------------------

오후 5:35 2023-07-26
x64, x86에서 둘다 돌아가게 하려다가 둘다 안돌아가게 되어벌임;
건든적 없는 inputManager에서 오류가 난다.

한 번 재생
반복재생
loadSound 까지 만듦
일시정지랑 정지만들어볼까?


아니었다. 멤버변수 하나로 사운드소스를 관리하고 있기때문에(임시로)
노래하나를 재생할때마다 기존에 존재하는 사운드소스가 삭제되지 않고
무한하게 메모리에 쌓이고 있었다. 진단도구에서 메모리 변화를 보면
극명한 계단식 소스증가량을 확인할 수 있다. 

사운드 생성함수를 반복문에서 제거하니 사운드로인한 메모리누수는 발생하지 않았다.
씬별로 필요한 소리들을 한번에 만들어두고 필요에 따라 재생하는 방식이 필요하지 않을까? 

사운드함수를 메인에서 제거했는 데도 메모리누수가 꾸준히 나고 있는데 나때문은 아니겠지? 
----------------------------------
오후 4:37 2023-07-27

나 때문이 아니었다.
fmod를 붙이기위해선 dll의 대한 이해가 필요했다.ㅣ

실시간 편집가능한 자체엔진을 만들기 위해서도 dll이 필요하다

dll의 필요성을 느낀다.

----------------------------------
오후 8:58 2023-07-29오후 9:58 2023-07-29

이제 까지 그냥 fmod로 이것저것 해보긴 했는데
이게 사운드 매니저를 만드는건 아니겠다는 생각이 들었다.

사운드매니저엔 뭐가 필요하지? 생각하다가

적어도 리소스 매니저랑 이것저것 소통은 해야겠구나 라는 생각이 들었다.

그럼 리소스매니저에 뭔가 주고 뭔가 받아와야겠지?? 
라는 생각을 했다

리소스 매니저에 줘야하는 것은 Sound객체의 포인터이다
그럼 리소스 매니저에서 받아와야 하는것은 뭐지?? 

누워서 대충 생각해보다가 
리소스매니저랑 그래픽스 엔진이 주고받는걸 보고 
비슷하게 만들면 되지 않을까? 라는 생각이 들었다.

loadImage와 LoadSound는 비슷한 형태의 함수인듯

하지만 BGM은 루프하고 sfx는 루프하지 않지 때문에 
사운드를 2개로 나눠서 재생하는 방식을 택하는게 좋을까? 
사운드매니저에서 생성시할 때 옵션에 상관없이
루프하거나 하지않거나를 정할 수 있으면 상관없이 만들 수 있을 텐데


근데 사운드 디자인할때도 대사, 음악, 효과음을 구분하니까 괜찮을지도? 
----------------------------------

오전 10:15 2023-07-31

사운드를 재생하는 방식이 맘에들지 않는다
초기화과정에서 n개의 맥스채널을 만들고 재생하면
n번 재생할때 까지는 여러 채널이 사용되다가

n번 이후로는 모노채널로 밖에 재생하지 않는다

찾아보니 초기화할때 쓰는 채널, 채널객체, 가상채널
전부 다른 거였다.

어처구니가 없다.

그래서 명시적인 채널 지정과 상관없이 초기화에서 만든 하드웨어채널을
임의적으로 스틸해서 재생하고

재생할때 채널이나 채널그룹 지정 없이도 돌아가는 거였다.

아니 이게 말이되나

채널은 그럼 그냥 효과음 묶어서 쓰는 용도 밖에 안되는건가? 

어처구니가 ㅇ벗다

트랙과 버스개념이 완전뒤집어진 느낌 
용서가 안됨


오전 11:54 2023-07-31
민동휘 피셜
" 환형 큐로 만들어 보십시오! " 
졸라 그럴듯함

특) 졸라 그럴듯 하지 않음
채널객체에서는 해결될수 없는 문제같다

1. 채널객체와 가상채널을 연결할 수 있어야하고
2. 사용되지 않는 가상채널을 사용할 수 있게만들면 된다

오후 5:50 2023-07-31
동시에 재생하는 기능이 해결되었다.

채널을 묶어서 재생 채널을 할당하거나 한 것은 아니지만

중요한 것은 fmod의 update 였다.

"FMOD 시스템을 업데이트합니다. 이것은 '게임' 틱당 한 번 또는 애플리케이션의 프레임당 한 번 호출되어야 합니다."
update 함수 서두에 적혀있던 이 말은 선택사항이 아니었던 것이다.

특정 채널의 사용이 완료되었다는 사실은 
fmod를 업데이트 하기 전에는 아무도 몰랐던 것이다!!!! 

제한된 채널 안에서 소리를 중첩해서 재생하고 싶다는 나의 소망은 이것으로 해결되었다.
후련하고 허무하다

사실 예제 대로 사용하면 전혀 문제 없었는데.. 

용도도 모르면서 사용하지 않는다는(않을것 같다는) 이유로 지워버린 나의 불찰이다

update의 중요성.. 아시겠습니까? 


오후 6:07 2023-07-31

지금부터 볼륨 조절 함수를 만든다
볼륨 조절은 채널단위로 진행한다.
-> 채널 구조를 잘 짜자
-> 재생되는 사운드와 채널이 일정하게 연결되도록 하자

[하자]

1. playback 함수에 볼륨인자를 넣는다
	단! 기본값을 넣어주자

[의문]
1. 채널 재생이 환형큐로 이루어지면 좋을까? 

[깨달음]

채널그룹 볼륨은 바로 세팅할 수 있지만
채널 세팅은 채널을 일시정지 하고 세팅해주어야한다.

	m_channelSFX->setPaused(true);
	m_channelSFX->setVolume(0.5f);
	m_channelSFX->setPaused(false);

오후 7:12 2023-08-01

볼륨은 만들었다

다음으로 만들건 fade in/out
리버브
eq

채널에 1:1로 할당하는게 좋을까? 

만들면 좋은것
void CrossFade(sound1, sound2)
{
	사운드 소스 2개를 재생한다.
	
	bool값(특정오브젝트, 씬의 상태)를 체크 해서
	true/false 에 따라 사운드소스가 크로스페이드로 넘어간다

}


channel 함수중에 fadePoint 라는 놈이 있었다.
이놈은 볼륨 브레이크 포인트를 생성한다



----------------------------------
오후 5:53 2023-08-02
fade in/out을 편리하게 만들어보자

fadein/out은 재생옵션인 편이 좋을 듯

잘못된 구조를 완성시키고 싶다

error : 멤버 함수 반환하기

warring 멤버함수를 반환하지 마십시오
멤버함수를 반환하려는 시도를 해야한다면 구조를 다시 짜십시오
하지만 반드시 멤버함수를 반환할 수 밖에없다면 
SoundManager.cpp 194~211 번 줄을 참고하십시오
warring 멤버함수를 반환해야하는 일은 존재하지 않습니다.

----------------------------------

오전 9:45 2023-08-03

몇개의 소리를 넣어두고
지정해둔 범위안에서 pitch변조 후
랜덤하게 소리를 재생한다.

오후 4:55 2023-08-03

PAN과 Volume을 컨틀롤할 수 있는 함수가 있으면 좋을 것 같다


리버브가 나오도록 할 수 있다

그런데 옵션이 조금 이상하달까?
라이브러리를 사용하는 일이라 기능구현은 어렵지 않은데

이걸 사용하는 일은 쉽지 않다

리버브를 만들 수 는 있는데 제대로 만들 수 없다

전체에 적용되고 전체에서 종료해야한다.


----------------------------------



1. 다른사람 사운드 매니저를 보자

[매니저는 무엇을 갖고 있어야 하는가?]
1. Init()
2. Update(); // fmod에서는 정말 필요함

[요청]
1. 겹쳐서 나는 효과음
2. 앞에 재생하던 노래를 끊고 재생한다
3. 노래를 겹쳐서 재생한다.
4. 동시재생과 끊고 재생 만들기

1. 한번 재생하면 그파일을 끝까지 재생한다
2. 누른시간 만큼만 재생한다.
3. 전에 소리끝난던 부분 부터 시작
4. 음원 처음 부터 시작

1. 소리 크기 조절
2. 거리에 따라 소리가 작아진다.
3. 시야에 따라 소리가 나거나 나지 않는다.
4. 소리 우선순위

// 필요하면 3D사운드를 붙인다.

